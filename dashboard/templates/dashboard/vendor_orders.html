{% extends "dashboard/base.html" %}
{% block container %}
<h2>Vendor Orders</h2>

{% if error %}
    <p class="error">{{ error }}</p>
{% else %}
    <form method="get">
        <label for="status">Filter by Status:</label>
        <select name="status" id="status" onchange="this.form.submit()">
            <option value="">All</option>
            {% for value, label in status_choices %}
                <option value="{{ value }}" {% if current_status == value %}selected{% endif %}>
                    {{ label }}
                </option>
            {% endfor %}
        </select>
    </form>

    <table border="1">
        <tr>
            <th>Order ID</th>
            <th>Product</th>
            <th>Customer</th>
            <th>Email</th>
            <th>Quantity</th>
            <th>Total Price</th>
            <th>Status</th>
            <th>Ordered On</th>
            <th>Action</th>
        </tr>
        {% for order in page_obj %}
        <tr>
            <td>{{ order.id }}</td>
            <td>{{ order.product.name }}</td>
            <td>{{ order.user.full_name }}</td>
            <td>{{ order.user }}</td>
            <td>{{ order.quantity }}</td>
            <td>{{ order.total_price }}</td>
            <td>{{ order.get_status_display }}</td>
            <td>{{ order.created_at }}</td>
            <td>
                <a href="{% url 'dashboard:vendor_order_update' order.id %}" class="btn">Update</a>
            </td>
        </tr>
        {% endfor %}
    </table>

    <!-- Pagination Controls -->
    <div class="pagination">
        <span class="step-links">
            {% if page_obj.has_previous %}
                <a href="?page=1{% if current_status %}&status={{ current_status }}{% endif %}">First</a>
                <a href="?page={{ page_obj.previous_page_number }}{% if current_status %}&status={{ current_status }}{% endif %}">Previous</a>
            {% endif %}

            <span class="current">
                Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
            </span>

            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}{% if current_status %}&status={{ current_status }}{% endif %}">Next</a>
                <a href="?page={{ page_obj.paginator.num_pages }}{% if current_status %}&status={{ current_status }}{% endif %}">Last</a>
            {% endif %}
        </span>
    </div>
{% endif %}
{% endblock container %}